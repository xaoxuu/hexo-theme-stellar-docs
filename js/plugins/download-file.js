function extToMimes(e){let a=void 0;switch(e){case"jpg":a="image/jpeg";break;case"png":a="image/png";break;case"jpeg":a="image/jpeg";break;case"gif":a="image/gif";break;case"bmp":a="image/bmp";break;case"txt":a="text/plain";break;case"xls":a="application/vnd.ms-excel";break;case"doc":a="application/msword";break;case"pdf":a="application/pdf";break;case"xlsx":a="application/vnd.ms-excel";break;case"csv":a="text/csv";break;case"mp4":a="video/mp4";break;case"avi":a="video/x-msvideo";break;case"WindowsMediaVideo":a="video/x-ms-wmv";break;case"mov":a="video/quicktime";break;case"flash":a="video/x-flv";break;case"mkv":a="video/x-matroska";break;case"mp3":a="audio/mpeg";break;case"wav":a="audio/wav";break;case"flac":a="audio/flac";break;case"aac":a="audio/aac";break;case"wma":a="audio/x-ms-wma";break;default:a="text/plain"}return a}function formatFileSize(e){var a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];let t=e,i=0;for(;1024<=t&&i<a.length-1;)t/=1024,i++;return""+(t=Math.round(100*t)/100)+a[i]}var file_contents={};function cacheDatas(e,a){var t=a.file,a=e.split("/").at(-1),i=extToMimes(a.split(".")[1]),n=t?t.data.length:0,o=new ArrayBuffer(n),c=new Uint8Array(o);for(let e=0;e<n;++e)c[e]=t.data[e];var o=new Blob([o],{type:i}),i=formatFileSize(o.size),r={};r.name=a,r.size=i,r.blob=o,file_contents[e]=r}function renderFileDom(e,a){e=e.querySelector(".file-size"),a=file_contents[a].size;e&&a&&(e.innerHTML=a)}function downloadFile(e){var e=file_contents[e],a=document.createElement("a");a.download=e.name,a.href=URL.createObjectURL(e.blob),document.body.appendChild(a),a.click(),document.body.removeChild(a)}function downloadFileEvent(a){for(let e=0;e<a.length;++e){let i=a[e];const n=ctx.tag_plugins.chat.api+"?type=file&url=";new IntersectionObserver((e,t)=>{utils.requestAnimationFrame(()=>{e.filter(e=>e.isIntersecting).sort((e,a)=>e.intersectionRect.y!==a.intersectionRect.y?e.intersectionRect.y-a.intersectionRect.y:e.intersectionRect.x-a.intersectionRect.x).forEach((e,a)=>{t.unobserve(e.target),setTimeout(()=>{let a=e.target.getAttribute("url");fetch(n+a).then(function(e){if(e.ok)return e.json();throw new Error("Network response was not ok.")}).then(function(e){cacheDatas(a,e),renderFileDom(i,a)}).catch(function(e){console.log(e)}),i.addEventListener("click",()=>{downloadFile(a)})},Math.max(100,16)*(a+1))})})}).observe(i)}}