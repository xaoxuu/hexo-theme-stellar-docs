function fillRoundRect(e,t,a,i,n,r,l){if(i<2*r||n<2*r)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,i,n,r),e.fillStyle=l||"#000",e.fill(),e.restore()}function strokeRoundRect(e,t,a,i,n,r,l,s){if(i<2*r||n<2*r)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,i,n,r),e.lineWidth=l||2,e.strokeStyle=s||"#000",e.stroke(),e.restore()}function drawRoundRectPath(e,t,a,i){e.beginPath(0),e.arc(t-i,a-i,i,0,Math.PI/2),e.lineTo(i,a),e.arc(i,a-i,i,Math.PI/2,Math.PI),e.lineTo(0,i),e.arc(i,i,i,Math.PI,3*Math.PI/2),e.lineTo(t-i,0),e.arc(t-i,i,i,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-i),e.closePath()}function fillRoundRectPro(e,t,a,i,n,r,l,s,o,c){if(i<r+l||i<o+s||n<r+o||n<l+s)return!1;e.save(),e.translate(t,a),drawRoundRectPathPro(e,i,n,r,l,s,o),e.fillStyle=c||"#000",e.fill(),e.restore()}function drawRoundRectPathPro(e,t,a,i,n,r,l){e.beginPath(0),e.arc(t-r,a-r,r,0,Math.PI/2),e.lineTo(l,a),e.arc(l,a-l,l,Math.PI/2,Math.PI),e.lineTo(0,i),e.arc(i,i,i,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-r),e.closePath()}function drawWave(t,a,i,n,r){for(let e=0;e<i.length;++e)fillRoundRect(t,4*e,(a-i[e])/2,2,i[e],n,r)}function drawWaveWhenPlaying(t,a,i,n,r,l,s){for(let e=0;e<n.length;++e)4*e+2<=i?fillRoundRect(t,4*e,(a-n[e])/2,2,n[e],r,l):4*e>=i?fillRoundRect(t,4*e,(a-n[e])/2,2,n[e],r,s):1<=i-4*e?(fillRoundRect(t,4*e,(a-n[e])/2,2,n[e],r,s),fillRoundRectPro(t,4*e,(a-n[e])/2,i-4*e,n[e],r,0,0,r,l)):(fillRoundRect(t,4*e,(a-n[e])/2,2,n[e],r,l),fillRoundRectPro(t,4*e,(a-n[e])/2,2-i+4*e,n[e],0,r,r,0,s))}function drawPlayLine(e,t,a,i){fillRoundRect(e,a,0,1,t,.1,i)}function createVoiceDom(a){for(let t=0;t<a.length;++t){let e=a[t];e.loop=!1;e.currentTime;e.classList.contains("qq")?isNaN(e.duration)||e.duration===1/0?e.addEventListener("durationchange",()=>{createWaveDom(e)}):createWaveDom(e):e.classList.contains("wechat")&&(isNaN(e.duration)||e.duration===1/0?e.addEventListener("durationchange",()=>{createWechatVoiceDom(e)}):createWechatVoiceDom(e))}}function createWaveDom(s){var o=s.parentElement;let c=o.querySelector("canvas");if(c.getContext("2d")){var d=s.duration,d=Math.floor(d),h=25<d+2?25:d+2;let e=o.querySelector(".pause-btn"),t=o.querySelector(".play-btn"),a=(o.querySelector(".voice-seconds").innerHTML=`${60<d?"..":d}"`,window.devicePixelRatio),i=(c.width=2*(2*h-1)*a,c.height=23*a,c.style.width=2*(2*h-1)+"px",c.style.height="23px",[]);for(let e=0;e<h;++e){var u=(Math.floor(51*Math.random())+30)/100*c.height*.8;i.push(u)}var f=c.getContext("2d");f.scale(a,1);let n="#333",r="#999",l=(c.classList.contains("right")&&(n="#ffffff",r="#1373b3"),"dark"===utils.dark.mode&&(n="#ccc",r="#707070",c.classList.contains("right"))&&(n="#fff9",r="#6797b780"),!1);drawWave(f,c.height,i,1,n),s.addEventListener("timeupdate",()=>{0<s.currentTime&&("dark"===utils.dark.mode?(n="#ccc",r="#707070",c.classList.contains("right")&&(n="#fff9",r="#6797b780")):(n="#333",r="#999",c.classList.contains("right")&&(n="#ffffff",r="#1373b3")),utils.requestAnimationFrame(()=>{f.clearRect(0,0,c.width,c.height),drawWaveWhenPlaying(f,c.height,s.currentTime/s.duration*c.width/a,i,1,n,r),drawPlayLine(f,c.height,s.currentTime/s.duration/a*c.width,n)}))}),s.addEventListener("ended",()=>{s.pause(),e.style.display="none",t.style.display="flex",s.currentTime=0,utils.requestAnimationFrame(()=>{f.clearRect(0,0,c.width,c.height),drawWave(f,c.height,i,1,n)}),l=!1}),o.addEventListener("click",()=>{l="flex"===e.style.display?(s.pause(),e.style.display="none",!(t.style.display="flex")):(s.play(),e.style.display="flex",t.style.display="none",!0)}),utils.dark.push(function(){l||("dark"===utils.dark.mode?(n="#ccc",r="#707070",c.classList.contains("right")&&(n="#fff9",r="#6797b780")):(n="#333",r="#999",c.classList.contains("right")&&(n="#ffffff",r="#1373b3")),0<s.currentTime?utils.requestAnimationFrame(()=>{f.clearRect(0,0,c.width,c.height),drawWaveWhenPlaying(f,c.height,s.currentTime/s.duration*c.width/a,i,1,n,r),drawPlayLine(f,c.height,s.currentTime/s.duration/a*c.width,n)}):utils.requestAnimationFrame(()=>{f.clearRect(0,0,c.width,c.height),drawWave(f,c.height,i,1,n)}))})}else console.log("浏览器不支持canvas")}function createCssStyle(e,t){var a=e.duration,i=Math.floor(a),n=25<i+2?25:i+2,r=e.parentElement;let l=r.querySelector(".pause-btn"),s=r.querySelector(".play-btn");r.querySelector(".voice-seconds").innerHTML=`${60<i?"..":i}"`;var o=2*(2*n-1),c=(25<i+2&&(r.style.width="100%"),document.createElement("div"));let d=document.createElement("div");d.className="play-line",c.append(d),c.className="voice-wave voice-wave-"+(t+1);for(let e=0;e<n;e++){var h=document.createElement("span");h.className="voice-wave-item",c.append(h)}r.insertBefore(c,r.querySelector(".voice-metas")),e.addEventListener("ended",()=>{e.pause(),l.style.display="none",s.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")}),r.addEventListener("click",()=>{"flex"===l.style.display?(e.pause(),l.style.display="none",s.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")):(e.play(),l.style.display="flex",s.style.display="none",d.classList.add("active"),d.classList.remove("back"))});let u=`
    .voice-wave.voice-wave-${t+1}>.play-line {
        transition: transform ${a}s linear;
        -moz-transition: transform ${a}s linear;
        -webkit-transition: transform ${a}s linear;
        -o-transition: transform ${a}s linear;
    }
    .voice-wave.voice-wave-${t+1}>.play-line.active {
        transform: translateX(${o}px);
    }
    `;for(let e=0;e<n;++e)u+=`
        .voice-wave-${t+1} span.voice-wave-item:nth-child(${e+1}) {
            height: ${10*(Math.floor(8*Math.random())+3)}%;
            margin-left: ${0==e?0:2}px;
        }
        `;i=document.createElement("style");i.setAttribute("type","text/css"),i.innerHTML=u,document.getElementsByTagName("head").item(0).appendChild(i)}function createWechatVoiceDom(e){var t=e.parentElement;let a=t.querySelector(".wechat-voice");var i=e.duration,i=Math.floor(i);t.querySelector(".voice-seconds").innerHTML=`${60<i?"..":i}"`,t.querySelector(".voice-placeholder").style.width=2*i+"px";let n=!1;e.addEventListener("ended",()=>{e.pause(),a.classList.remove("play"),e.currentTime=0,n=!1}),t.addEventListener("click",()=>{n=n?(e.pause(),a.classList.remove("play"),!1):(e.play(),a.classList.add("play"),!0)})}