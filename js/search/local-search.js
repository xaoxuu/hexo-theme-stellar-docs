var searchCache=null,searchCacheKey="search_cache_v1",searchFunc=function(e,d,a,c,s){function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function t(e){var n,r,t=document.getElementById(c);t&&!t._searchInitialized&&(t._searchInitialized=!0,n=document.getElementById(s),r=document.getElementById(a),t.addEventListener("input",function(){var u=[],p=function(n){var r=[];for(let t=0;t<n.length;t++)for(let e=t+1;e<=Math.min(t+3,n.length);e++)r.push(n.slice(t,e).join(" "));return r}(this.value.trim().toLowerCase().split(" ")).sort(function(e,t){return t.split(" ").length-e.split(" ").length});if(n.innerHTML="",this.value.trim().length<=0)r.setAttribute("searching","false");else if(r.setAttribute("searching","true"),e.forEach(function(e){var t,n,r,a,c,s,h,i,l,o;!e.content?.trim().length||d&&!e.path.includes(d)||(t=0,l=e.title?.trim()||"Untitled",n=l.toLowerCase(),o=e.content,r=o.toLowerCase(),e=e.path.startsWith("//")?e.path.slice(1):e.path,s=c=a=-1,p.forEach(function(e){a=n.indexOf(e),c=r.indexOf(e),(0<=a||0<=c)&&(t+=1,c<0&&(c=0),s<0)&&(s=c)}),0<t&&(h=document.createElement("li"),(i=document.createElement("a")).href=e,(e=document.createElement("span")).className="search-result-title",e.textContent=l,i.appendChild(e),0<=s&&(l=Math.max(0,s-20),e=Math.min(o.length,s+80),o=o.substring(l,e=0===l?100:e),l=new RegExp(p.map(m).join("|"),"gi"),o=o.replace(l,function(e){return'<span class="search-keyword">'+e+"</span>"}),(e=document.createElement("p")).className="search-result-content",e.innerHTML=o+"...",i.appendChild(e)),h.appendChild(i),u.push({rank:t,element:h})))}),u.length){u.sort(function(e,t){return t.rank-e.rank});const t=document.createElement("ul");t.className="search-result-list",u.forEach(function(e){t.appendChild(e.element)}),n.innerHTML="",n.appendChild(t)}}))}if(searchCache)t(searchCache);else{const n=setInterval(()=>{searchCache&&(clearInterval(n),t(searchCache))},100)}};utils.jq(()=>{var e=ctx.search.path;e.startsWith("/")&&(e=e.substring(1)),e=ctx.root+e;try{var t=localStorage.getItem(searchCacheKey);t&&(searchCache=JSON.parse(t))}catch(e){console.warn("搜索缓存解析失败",e)}fetch(e).then(e=>e.json()).then(e=>{searchCache=e;try{localStorage.setItem(searchCacheKey,JSON.stringify(e))}catch(e){console.warn("搜索缓存写入失败",e)}});var n,r=$("input#search-input");0!=r.length&&(n=document.querySelector("div#search-result"),r.focus(function(){var e=ctx.search.path,t=(e.startsWith("/")&&(e=e.substring(1)),e=ctx.root+e,r.attr("data-filter")||"");searchFunc(e,t,"search-wrapper","search-input","search-result")}),r.keydown(function(e){13==e.which&&e.preventDefault()}),new MutationObserver(function(e){var t=n.querySelector(".search-result-list li");$(".search-wrapper").toggleClass("noresult",!t)}).observe(n,{childList:!0,subtree:!0}))});