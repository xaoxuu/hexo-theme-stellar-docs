utils.jq(()=>{Array.from(document.getElementsByClassName("ds-memos")).forEach(i=>{const t=i.getAttribute("api");if(!t)return;const r=i.getAttribute("avatar")||def.avatar,n=i.getAttribute("limit"),l=t.match(/https:\/\/(.*?)\/(.*)/i)[1];utils.request(i,t,async e=>{e=await e.json();let s=d.identify(e);if("feature"!==s.version){const t=i.getAttribute("user")?.split(",")||[],a=i.getAttribute("hide")?.split(",")||[];await Promise.all(s.data.slice(0,n||s.data.length).map(e=>async function(e,s,t,a,i,r){var n=d[s.version]||d.feature;return`<div class="timenode">
                      <div class="header">${t.length||a.includes("user")?"":await n.buildUser(e,s,i)}
                      <span>${n.buildDate(e).toLocaleString()}</span></div>
                      <div class="body">${marked.parse(e.content||"")}
                      <div class="tag-plugin image">${n.buildImages(e,r).join("")}</div>
                      </div></div>`}(e,s,t,a,r,l).then(e=>$(i).append(e))))}});const d={"22-":{buildUser:async(e,s,t)=>`<div class="user-info">${t?`<img src="${t}">`:""}<span>${e.creatorName}</span></div>`,buildDate:e=>new Date(1e3*e.createdTs),buildImages:(e,s)=>(e.resourceList||[]).filter(e=>e.type?.includes("image/")).map(e=>`<div class="image-bg"><img src="${e.externalLink||`https://${s}/o/r/`+e.id}"></div>`)},"22+":{buildUser:async(e,s,t)=>{const a=e?.creator.split("/")[1];let i=s.users.find(e=>e.id===parseInt(a));i||(s.requests[a]||(s.requests[a]=fetch(s.site+"/api/v1/users/"+a).then(e=>e.json()).then(e=>{e.username?(i=e,s.users.push(e)):i=null}).finally(()=>delete s.requests[a])),await s.requests[a],i=s.users.find(e=>e.id===parseInt(a)));e=i?i.nickname||i.username:"memos",t=i?.avatarUrl?""+s.site+i.avatarUrl:t||"";return`<div class="user-info">${t?`<img src="${t}">`:""}<span>${e}</span></div>`},buildDate:e=>new Date(e.createTime),buildImages:e=>(e.resources||[]).filter(e=>e.type?.includes("image/")).map(e=>`<div class="image-bg"><img src="${e.externalLink||`https://${l}/o/r/`+e.id}"></div>`)},feature:{buildUser:async()=>"memos",buildDate:()=>new Date,buildImages:()=>[]},identify:e=>{var s={version:"feature",users:[],site:t.split("/api/v1")[0],requests:{},data:[]};return Array.isArray(e)?(s.version="22-",s.data=e):e.memos?(s.version="22+",s.data=e.memos):(s.version="feature",console.log("当前Memos版本过高，请到Stellar社区反馈")),s}}})});